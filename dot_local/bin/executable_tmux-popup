#!/usr/bin/env bash
# vim: set ft=sh :

__session_name() {
  echo "zzz-${1}"
}

__create_session() {
  local name="$1"
  local program="$2"

  if ! tmux has-session -t "${name}" 2>/dev/null; then
    tmux new-session -d -s "${name}" "${program}"
  fi
}

__open_popup() {
  local name="$1"

  tmux display-popup -w 95% -h 95% -E "tmux attach-session -t '${name}'"
}

if [ -z "$1" ]; then
  echo "Usage: tmux-popup <program>"
  exit 1
fi

if ! command -v "$1" >/dev/null 2>&1; then
  echo "Error: $1 not found"
  exit 1
fi

name=$(__session_name "$1")
__create_session "${name}" "$1"
__open_popup "${name}"
